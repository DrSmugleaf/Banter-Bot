//
// Copyright (c) 2017 DrSmugleaf
//

doctype html
html(lang="en")
  head
    include ../../partials/header
  body
    include ../../partials/eve/navigation
    
    div.jumbotron
      div.container
        h1 Mango Deliveries
        p Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.
    
    div.container.text-center
      form(method="post" action="/eve/submit")
        div.row
          div#image_container
            div.col-md-2.col-md-offset-3
              div.panel.panel-default
                div.panel-heading 7RM-N0
                div.panel-body(style="padding: 0px;")
                  img(class="img-responsive center-block" src="../7RM-N0.png" value="7RM-N0" width="100%")
            div.col-md-2
              div.panel.panel-default
                div.panel-heading GME-PQ
                div.panel-body(style="padding: 0px;")
                  img(class="img-responsive center-block" src="../GME-PQ.png" value="GME-PQ" width="100%")
            div.col-md-2
              div.panel.panel-default
                div.panel-heading B-9C24
                div.panel-body(style="padding: 0px;")
                  img(class="img-responsive center-block" src="../B-9C24.png" value="B-9C24" width="100%")
        div.row
          div.col-md-6.col-md-offset-3
            div.form-group
              div.panel.panel-default
                div.panel-heading Contract
                div.panel-body
                  div.form-group
                    div.row
                      label.col-md-3(for="link") Appraisal link
                      div.col-md-6
                        input(name="link" type="text" class="form-control" id="link" placeholder="http://evepraisal.com/e/16231499" autocomplete="off" data-toggle="tooltip" title="")
                      div(class="col-md-3")
                        div.input-group
                          label(class="sr-only" for="multiplier") Multiplier
                          input(name="multiplier" type="text" class="form-control" id="multiplier" placeholder="1" autocomplete="off")
                          div.input-group-addon x
                  div.form-group
                    div.row
                      label.col-md-3(for="destination") Destination
                      div.col-md-9
                        input(class="form-control" type="text" id="destination" autocomplete="off" readonly)
                  div.form-group
                    div.row
                      label.col-md-3(for="jita-sell") Jita Sell
                      div.col-md-9
                        div.input-group
                          input(class="form-control" type="text" id="jita-sell" autocomplete="off" readonly)
                          div.input-group-addon ISK
                  div.form-group
                    div.row
                      label.col-md-3(for="quote") Quote
                      div.col-md-9
                        div.input-group
                          input(class="form-control" type="text" id="quote" autocomplete="off" readonly)
                          div.input-group-addon ISK
                  div.form-group
                    button(type="submit" class="btn btn-primary") Create Contract
    
    include ../../partials/footer
    script.
      $("#link").change(function() {
        $.ajax({
          type: "GET",
          url: "/eve/query",
          data: {
            link: $("#link").val(),
            multiplier: $("#multiplier").val()
          },
          success: function(res) {
            $(".parent-has-error").attr("data-original-title", '').tooltip("fixTitle").tooltip("hide")
            $(".has-error").removeClass("has-error")
            $("#jita-sell").val(res.jita + " (" + res.jitaShort + ")")
            $("#quote").val(res.quote + " (" + res.quoteShort + ")")
          },
          error: function(res) {
            res = JSON.parse(res.responseText)
            if(res.invalid) {
              $(".parent-has-error").attr("data-original-title", '')
              $(".has-error").removeClass("has-error")
              for(var element in res.invalid) {
                if(!res.invalid.hasOwnProperty(element)) return
                $(element).addClass("parent-has-error")
                $(element).parent().addClass("has-error")
                $(element).prop("title", res.invalid[element]).tooltip("fixTitle").tooltip("show")
              }
            }
          }
        }).done()
      })
    
    script.
      $("div#image_container div div").click(function() {
        $("input#destination").val($("div img", this).attr("value"))
        $("div#image_container div div img").css("outline", "")
        $("div img", this).css("outline", "4px solid #0088CC")
      })
    
    script.
      $(document).ready(function() {
        $('[data-toggle="tooltip"]').tooltip()
      })
